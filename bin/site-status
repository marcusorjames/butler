#!/bin/bash
# site status subcommand

PACKAGE="butler site status"
COMMON=$DIR/common

. $COMMON/functions.sh

print_usage() {
  echo "Show the status of a site or all sites"
  echo " " echo "SYNOPSIS:"
  echo " "
  echo "$PACKAGE NAME [OPTION]"
  echo " "
  echo "  -h, --help          print this help"
  echo "  -v, --verbose       print site directory"
}

check_app_exists() {
  app_path="$SITES_DIR/$1/app"
  [ -e $app_path ] && return 0
  return 1
}

main() {
  help=false
  verbose=false

  args=()

  while [[ $# -gt 0 ]]; do
    case "$1" in
      -h|--help)    help=true ;;
      -v|--verbose) verbose=true ;;
      --)           shift; break ;;
      *)            args+=("$1") ;;
    esac
    shift
  done

  set -- "${args[@]}"

  $help && print_usage && exit 0

  template_root="$DIR/../templates"

  site="$1"

  [ -z $1 ] && echo -e "${CWarn}All sites is not yet implemented" && exit 0

  if ! site_dir="$(get_site_dir "$site")"; then
    die_with_error "Site ${CWarn}$site${Color_Off} doesn't exist"
  fi


  echo -en "$site "
  if check_app_exists $site; then
    echo -e "${CSuccess}OK${Color_Off}${verbose:+ [$site_dir]}"
  else
    echo -e "${CError}ERROR${Color_Off}"
    echo -en "Run ${Black}${On_White}butler site link <site>${Color_Off} " \
      && echo "to link the project directory"
  fi
}

main "$@"
