#!/bin/sh
# mysql

PACKAGE="butler mysql"
DIR="$DIR/bin"

# Ensure we are not in a docker directory as this breaks --project-directory
# docker-compose commands!
cd $DIR

# Ensure mysql is up
[ ! "$(docker ps | grep mysql)" ] && docker compose \
  --project-directory "$DIR/../common/mysql" up -d

function="$1"
shift

argRem="$@"
[ -z "${function}" ] || argRem="$function $argRem";

mysql_password="${MYSQL_PASSWORD:-secret}"

case $function in
    'log') . $DIR/mysql-log ;;
    *) docker compose --project-directory "$DIR/../common/mysql" exec mysql mariadb --password="$MYSQL_PASSWORD" "$argRem" ;;
esac
